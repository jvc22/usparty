import { Box, Button, TextInput } from "@ignite-ui/react";
import { ArrowRight, List, X } from "phosphor-react";
import img from '../assets/online.svg';
import Image from "next/image";
import { z } from "zod";
import { useForm } from "react-hook-form";
import { zodResolver } from '@hookform/resolvers/zod';
import { useRouter } from "next/router";
import Head from "next/head";
import Link from "next/link";
import { useEffect, useState } from "react";
import { SidebarItem } from "@/components/SidebarItem";
import { useUserContext } from "@/context/UserContext";
import { parseCookies } from "nookies";

const claimUsernameFormSchema = z.object({
  username: z.string()
            .min(3, {message: 'O usuário deve conter pelo menos 3 letras.'})
            .max(20, {message: 'O usuário deve conter no máximo 20 letras.'})
            .regex(/^([a-z]+)$/i, {message: 'O usuário deve conter apenas letras.'})
            .transform(username => username.toLowerCase())
})

type ClaimUsernameFormData = z.infer<typeof claimUsernameFormSchema>

export default function ClaimUsername() {
  const { userInfo, setUserInfo } = useUserContext()
  const router = useRouter()

  useEffect(() => {
      const cookies = parseCookies()
      const username = cookies["@uspparty"]

      if(username) {
          setUserInfo({username})
          router.replace('/home')
      }
    }, []);

  const {register, handleSubmit, formState: {errors, isSubmitting}} = useForm<ClaimUsernameFormData>({
    resolver: zodResolver(claimUsernameFormSchema)
  })

  const [openMenu, setOpenMenu] = useState(false)

  async function handleClaimUsername(data: ClaimUsernameFormData) {
    const {username} = data
    await router.push(`/register/user-info?username=${username}`)
  }

  return (
    <div className="w-[100vw] h-[100vh] flex flex-col items-center p-8 relative">
          <div className={`h-full w-[70%] p-8 bg-[#202024] fixed right-0 top-0 md:hidden ${openMenu ? 'transition translate-x-0 duration-200' : 'transition translate-x-[100%] duration-200'}`}>
            <button onClick={() => {setOpenMenu(false)}}>
              <X className="text-gray-100 text-2xl focus:text-violet-400"/>
            </button>

            <div className="mt-8 flex flex-col gap-4">
              <SidebarItem title="Fazer login" url="login"/>
              <SidebarItem title="Criar uma conta" url="register/user-info"/>
            </div>
          </div>

          <div className="w-full h-[96px] z-[-1] absolute top-0 border-b-[1px] border-[#323238]">
          </div>
      
      <div className="w-full text-gray-100 font-bold font-poppins text-2xl flex items-center justify-between">
        <div className="flex items-center gap-8">
          <Link href='/' className="cursor-pointer md:hover:scale-110 md:hover:text-violet-500 duration-200 max-md:focus:text-violet-500">USParty</Link>
          <div className="flex gap-8 max-md:hidden">
            <Link className="hover:text-violet-400 hover:duration-200 font-normal text-base" href=''>Sobre</Link>
            <Link className="hover:text-violet-400 hover:duration-200 font-normal text-base" href=''>Informações de contato</Link>
          </div>
        </div>
        <div className="font-normal text-base flex items-center gap-8 max-md:hidden">
          <Link className="hover:text-violet-400 hover:duration-200" href='/login'>Login</Link>
          <Button size={"sm"} variant={"secondary"} onClick={() => {router.push('/register/user-info')}}>
            <span className="font-poppins">Criar uma conta</span>
          </Button>
        </div>
        <button className="md:hidden" onClick={() => {setOpenMenu(true)}}>
          <List />
        </button>
      </div>
      <div className="max-w-[480px] mt-20">
        <div className="flex items-center justify-center">
          <svg width="248" height="152" viewBox="0 0 248 152" fill='none'xmlns="http://www.w3.org/2000/svg">
            <path d="M21.4461 2.20596V53.6765C21.4461 58.8236 22.7125 62.7862 25.2451 65.5638C27.7778 68.3414 31.4951 69.7305 36.3971 69.7305C41.2991 69.7305 45.0572 68.3414 47.6716 65.5638C50.286 62.7862 51.5932 58.8236 51.5932 53.6765V2.20596H72.5491V53.554C72.5491 61.2337 70.9149 67.7286 67.6471 73.0393C64.3793 78.3499 59.9674 82.353 54.4118 85.0491C48.938 87.7452 42.8105 89.0932 36.0295 89.0932C29.2484 89.0932 23.1618 87.7862 17.7696 85.1716C12.4592 82.4756 8.25169 78.4725 5.1471 73.1618C2.04252 67.7697 0.490234 61.2337 0.490234 53.554V2.20596H21.4461ZM118.392 89.0932C112.101 89.0932 106.464 88.0718 101.48 86.0295C96.4964 83.9872 92.4933 80.9639 89.4706 76.9609C86.5295 72.9578 84.9768 68.1373 84.8138 62.5001H107.118C107.444 65.6863 108.547 68.1373 110.427 69.853C112.305 71.4872 114.756 72.304 117.779 72.304C120.884 72.304 123.335 71.6098 125.132 70.2207C126.93 68.7501 127.828 66.7482 127.828 64.2158C127.828 62.0914 127.093 60.3351 125.623 58.9461C124.234 57.5572 122.477 56.4135 120.353 55.5148C118.31 54.6161 115.369 53.5949 111.529 52.4511C105.974 50.7354 101.439 49.0197 97.9265 47.304C94.413 45.5883 91.3904 43.0557 88.8579 39.706C86.3248 36.3563 85.0589 31.9854 85.0589 26.5932C85.0589 18.5867 87.959 12.3367 93.7599 7.84321C99.5601 3.26805 107.118 0.980469 116.431 0.980469C125.908 0.980469 133.547 3.26805 139.348 7.84321C145.148 12.3367 148.253 18.6275 148.662 26.7158H125.99C125.827 23.938 124.805 21.7729 122.927 20.2207C121.047 18.5867 118.637 17.7697 115.696 17.7697C113.163 17.7697 111.121 18.4641 109.569 19.853C108.016 21.1602 107.24 23.0802 107.24 25.6128C107.24 28.3906 108.547 30.5557 111.162 32.1079C113.776 33.6602 117.861 35.3351 123.417 37.1324C128.972 39.0115 133.466 40.8089 136.897 42.5246C140.41 44.2403 143.433 46.7321 145.966 50.0001C148.498 53.268 149.765 57.4756 149.765 62.6226C149.765 67.5246 148.498 71.9774 145.966 75.9805C143.515 79.9835 139.92 83.1698 135.181 85.5393C130.442 87.9088 124.846 89.0932 118.392 89.0932ZM228.225 29.902C228.225 34.8857 227.081 39.4609 224.794 43.6275C222.506 47.7125 218.993 51.0213 214.254 53.554C209.515 56.0867 203.633 57.353 196.607 57.353H183.617V88.2354H162.661V2.20596H196.607C203.47 2.20596 209.27 3.3906 214.009 5.75987C218.748 8.12918 222.302 11.3971 224.671 15.5638C227.04 19.7305 228.225 24.5099 228.225 29.902ZM195.014 40.6863C199.017 40.6863 201.999 39.7468 203.96 37.8677C205.921 35.9886 206.901 33.3334 206.901 29.902C206.901 26.4707 205.921 23.8155 203.96 21.9363C201.999 20.0572 199.017 19.1177 195.014 19.1177H183.617V40.6863H195.014Z" fill='white'/>
            <path d="M97.3084 85.3084C96.9196 84.6618 96.8224 84.1075 97.0168 83.8304L101.974 78.0111C102.266 77.5492 103.238 77.9187 104.016 78.6577C104.794 79.3966 105.182 80.3204 104.891 80.7822C104.891 80.8746 102.655 84.3847 99.1554 89.8345C100.225 90.943 101.197 92.3285 102.072 93.9912C102.558 94.9149 102.461 95.5615 101.683 95.4691C101.002 95.4691 100.03 94.6378 99.4471 93.8065C98.961 92.9751 98.475 92.2362 97.9889 91.5896C94.3922 97.0394 89.7261 104.06 84.7684 111.08C98.8638 109.509 111.987 103.783 120.833 96.4852C124.819 93.2522 127.832 89.7422 129.874 86.0473C131.915 82.4449 132.79 78.8424 132.401 75.24C132.109 72.2841 130.846 69.4206 128.513 66.8342C122.097 59.8141 105.766 56.5811 87.3931 57.2277C69.3121 57.8743 49.287 62.5852 34.6084 71.3604C27.9009 75.3323 22.1656 80.9669 19.2493 86.8787C17.9856 89.5574 17.2079 92.2362 17.2079 94.8225C17.2079 97.2242 17.7912 99.5335 19.1521 101.566C20.7074 103.967 23.5265 106.184 27.8037 108.032C28.6786 108.401 29.5535 109.417 29.7479 110.156C29.9423 110.987 29.3591 111.357 28.4842 110.987C22.9433 108.493 19.1521 105.26 16.7219 101.75C14.8749 98.7945 14 95.8386 14 92.7904C14 89.9269 14.8749 87.0634 16.2358 84.2923C19.2493 78.1958 25.0819 72.3765 31.9837 68.3122C46.7596 59.4446 66.9791 54.7337 85.3517 54.0871C104.794 53.3481 122.388 57.32 130.068 65.7258C133.373 69.3282 135.123 73.2078 135.609 76.995C135.998 80.9669 135.026 84.9389 132.887 88.7261C130.846 92.5133 127.638 96.1157 123.652 99.4411C114.32 107.108 100.516 113.02 85.8377 114.405C84.574 114.59 83.3103 114.682 82.1438 114.775C71.3535 129.646 59.494 144.056 53.5642 144.703C50.6479 144.98 49.1898 143.317 48.801 140.084C48.2177 135.466 52.4949 124.196 59.0079 113.112C59.2996 112.65 59.494 112.188 59.7856 111.726C59.3968 111.542 59.1052 111.357 58.7163 111.172C55.6056 109.602 53.3698 107.57 51.8145 105.353H51.7172C50.2591 103.136 49.4814 101.011 49.1898 98.8869C48.8982 96.4852 49.4814 94.2683 50.4535 92.5133C50.7451 92.0514 51.62 92.2362 52.4949 92.9751C53.2726 93.7141 53.7586 94.7302 53.467 95.192C52.5921 96.67 52.2033 98.6097 52.3977 100.642C52.4949 102.12 53.0782 103.598 53.9531 104.891L54.0503 104.983C54.9252 106.184 56.2861 107.385 58.3275 108.401C59.1052 108.863 60.0773 109.325 61.0493 109.694C67.2707 99.8106 75.0475 90.5735 82.4354 86.7863C87.1987 84.3847 91.9619 84.0152 96.1419 87.0634L97.3084 85.3084ZM65.1321 110.803C68.9233 111.542 73.6866 111.911 79.5191 111.542C85.2545 103.505 90.7954 95.2844 94.8782 89.0032C91.9619 87.5253 88.5596 88.0795 85.0601 89.9269C78.2554 93.437 71.0619 101.658 65.1321 110.803ZM77.0889 114.867C71.6452 114.867 67.1735 114.22 63.5768 113.112C63.0907 114.036 62.5075 114.867 62.0214 115.791C55.8972 126.321 51.7172 136.759 51.9117 141.377C57.3554 140.177 67.368 128.168 77.0889 114.867ZM140.119 108.309C140.508 109.232 140.216 109.787 139.438 109.602C138.661 109.417 137.689 108.586 137.3 107.754C135.356 105.999 130.592 108.124 128.843 109.509C125.246 112.281 123.204 115.606 122.135 119.855C125.537 118.931 134.383 109.14 134.383 109.14C134.772 108.771 135.647 109.048 136.522 109.879C137.203 110.618 137.591 111.449 137.3 111.911C137.105 112.373 135.939 114.775 136.522 117.361C136.91 119.578 149.548 109.509 149.742 109.417C150.131 109.048 150.909 108.586 151.687 109.325C152.464 110.156 152.367 110.895 151.978 111.265C145.563 116.714 141.771 119.947 139.147 121.241C134.675 123.457 131.273 122.164 131.37 117.638C127.87 120.779 124.274 123.642 122.135 122.718C121.357 122.441 120.774 121.887 120.19 121.333C119.218 120.132 118.829 118.839 119.024 117.453C119.121 116.345 119.51 115.144 120.093 113.943C121.357 111.357 123.593 108.493 126.121 106.554C130.495 103.136 138.466 102.951 140.119 108.309ZM155.258 100.088C155.55 99.6258 156.522 99.9029 157.299 100.642C158.174 101.381 158.563 102.397 158.271 102.859L154.675 108.309C158.077 106.738 162.743 105.26 164.687 107.57C165.562 108.493 165.271 110.618 166.534 110.71C168.381 110.803 171.103 110.433 173.728 109.694C174.311 109.509 174.894 109.048 175.478 109.879C176.158 110.803 175.769 111.08 175.186 111.172C172.367 112.003 167.701 112.927 165.659 112.742C163.132 112.558 162.354 111.911 160.216 109.509C158.758 107.847 150.106 115.144 150.106 115.144C149.911 115.236 144.857 123.365 144.371 124.196C144.079 124.658 143.107 124.381 142.329 123.642C141.454 122.903 141.065 121.887 141.357 121.425L155.258 100.088ZM201.231 68.4969C201.523 68.1274 202.495 68.3122 203.273 69.1435C204.05 69.8825 204.439 70.8985 204.148 71.268C204.148 71.3604 197.051 80.6898 189.469 91.4972H214.257C214.938 91.4972 216.007 92.2362 216.493 93.0675C217.076 93.9912 216.979 94.7302 216.299 94.7302H187.233C185.192 97.686 183.15 100.734 181.206 103.69V103.783C181.206 104.152 181.012 104.337 180.817 104.337C174.888 113.481 171.68 118.747 172.749 120.594C174.499 123.735 194.232 108.771 194.232 108.678C194.621 108.401 195.204 108.216 195.982 109.048C196.76 109.879 196.176 110.341 195.788 110.618C195.69 110.71 173.624 131.401 168.861 123.088C167.402 120.502 171.874 111.634 178.096 101.843C177.998 101.843 178.679 100.827 178.679 100.827C178.873 93.8065 153.988 94.7302 153.988 94.7302C153.307 94.7302 152.238 93.9912 151.752 93.0675C151.169 92.2362 151.266 91.4972 151.946 91.4972H184.803C192.969 79.3966 201.134 68.5893 201.231 68.4969ZM179.748 99.164C180.72 97.686 181.692 96.2081 182.664 94.7302L170.513 94.2683C173.429 95.3768 178.193 97.2242 179.748 99.164ZM245.467 128.076C246.245 128.168 247.217 128.907 247.703 129.831C248.189 130.662 248.092 131.309 247.314 131.309C226.706 129.646 211.541 130.016 200.556 131.494C194.043 141.932 186.753 152 183.447 152C178.976 151.908 175.087 149.598 173.143 146.365C172.074 144.518 171.685 142.393 172.366 140.361C173.046 138.514 174.504 136.666 177.129 134.911C181.114 132.233 187.725 129.831 197.835 128.353C200.362 124.289 202.792 120.224 204.834 116.714C201.82 119.208 198.709 121.148 196.668 120.963C195.793 120.871 195.113 120.686 194.432 120.317C192.488 119.301 191.419 117.73 191.419 115.791C191.321 114.682 191.71 113.297 192.391 111.819C193.654 108.863 196.182 105.26 199.293 101.75C199.681 101.288 200.654 101.658 201.431 102.397C202.209 103.228 202.598 104.152 202.209 104.614C199.098 108.032 196.668 111.542 195.404 114.405C195.21 114.775 195.015 116.807 195.599 117.176C202.306 118.562 213.777 102.859 212.999 102.305V102.397C213.388 101.935 214.166 102.212 215.041 102.951C215.818 103.69 216.304 104.614 216.013 105.076L213.874 108.678L213.777 108.771C213.777 108.863 208.819 117.915 202.889 127.799C213.485 126.69 227.483 126.598 245.467 128.076ZM195.404 132.325C188.114 133.803 183.059 135.743 179.851 137.96C177.421 139.53 176.06 141.285 175.476 142.855C174.99 144.333 175.185 145.534 175.671 146.458C176.546 147.751 178.684 148.675 181.406 148.767C184.031 148.767 189.766 141.193 195.404 132.325Z" fill='#8b5cf6'/>
            <path d="M72.2812 58.7106L72.5469 54.5264L64.2531 53.9997L63.9874 58.1839L72.2812 58.7106Z" fill='white'/>
            <path d="M71.3756 54.4604L51.4385 58.1255L52.2984 62.8033L72.2355 59.1383L71.3756 54.4604Z" fill='white'/>
            <path d="M58.8645 59.0404L49 63.6055L49.8227 65.3831L59.6872 60.8181L58.8645 59.0404Z" fill='white'/>
            <path d="M51.2565 59.4058L49 63.6587L51.4193 64.9423L53.6758 60.6894L51.2565 59.4058Z" fill='white'/>
            <defs>
            </defs>
          </svg>

          <div className="Img max-md:hidden flex flex-col items-center pointer-events-none">
            <Image src={img} width={200} quality={80} priority alt=""/>
          </div> 
          
        </div>
        <p className="text-[#A9A9B2] text-xl text-center mt-3">Encontre os principais eventos da USP Ribeirão!</p>

        <p className="text-gray-100 text-4xl font-poppins font-bold mt-10">Registre-se</p>

        <Box as='form' className="flex flex-col gap-2 max-md:gap-4 md:flex-row mt-5" onSubmit={handleSubmit(handleClaimUsername)}>
          <TextInput size='sm' prefix="usparty.com.br/" placeholder="seu-usuario" {...register('username')} className="lowercase"/>
          <Button size='sm' type="submit" disabled={isSubmitting}>
            Reservar
            <ArrowRight />
          </Button>
        </Box>

        <p className="mt-2 text-[#7C7C8A] text-sm">
          {errors.username ? <span className="text-[#F75A68]">{errors.username.message}</span> : 'Digite o nome de usuário desejado'}
        </p>

        <p className="mt-4 text-gray-100">
          Já possui uma conta? Faça <Link href={'/login'} className="font-bold text-violet-500 hover:text-violet-300 hover:duration-200">login</Link>!
        </p>
      </div>

      <Head>
        <title>Bem-vindo! | USParty</title>
      </Head>
    </div>
  )
}
